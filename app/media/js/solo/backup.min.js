if(typeof(akeeba)=="undefined"){var akeeba={}}if(typeof(akeeba.jQuery)=="undefined"){akeeba.jQuery=jQuery.noConflict()}if(typeof Solo=="undefined"){var Solo={}}if(typeof Solo.Backup=="undefined"){Solo.Backup={URLs:{},tag:"",translations:{},domains:{},commentEditorSave:null,maxExecutionTime:14,runtimeBias:75,srpInfo:{},returnUrl:"",isSTW:false}}(function(a){Solo.Backup.timer=function(){setTimeout("Solo.Backup.timerTick()",10)};Solo.Backup.timerTick=function(){try{console.log("Timer tick")}catch(b){}Solo.System.doAjax({ajax:"step",tag:Solo.Backup.tag},Solo.Backup.onStep,Solo.Backup.onError,false)};Solo.Backup.startTimeoutBar=function(c,b){var d=0;a("#response-timer div.text").everyTime(1000,"lastReponse",function(){d++;var e=Solo.Backup.translations["UI-LASTRESPONSE"].replace("%s",d.toFixed(0));a("#response-timer div.text").html(e)})};Solo.Backup.resetTimeoutBar=function(){Piecon.setOptions({color:"#333333",background:"#e0e0e0",shadow:"#000000",fallback:"force"});a("#response-timer div.text").stopTime();var b=Solo.Backup.translations["UI-LASTRESPONSE"].replace("%s","0");a("#response-timer div.text").html(b)};Solo.Backup.renderBackupSteps=function(c){var b="label-success";if(c==""){b="label-default"}a("#backup-steps").html("");a.each(Solo.Backup.domains,function(d,e){var f=a(document.createElement("div")).addClass("label").html(e[1]).data("domain",e[0]).appendTo("#backup-steps");if(f.data("domain")==c){b="label-default";this_class="label-info"}else{this_class=b}f.addClass(this_class)})};Solo.Backup.start=function(){try{console.log("Starting backup");console.log(data)}catch(g){}if(window.AVGRUN){try{console.warn("AVG Antivirus with Link Checker detected. The backup WILL fail!")}catch(g){}var d=confirm(Solo.Backup.translations.SOLO_BACKUP_AVGWARNING);if(!d){return}}try{if(Solo.Backup.commentEditorSave!=null){Solo.Backup.commentEditorSave()}}catch(c){a("#comment").val("")}var f="";try{f=a("#jpskey").val()}catch(c){f=""}var h="";try{h=a("#angiekey").val()}catch(c){h=""}a("#backup-setup").hide("fast");a("#backup-progress-pane").show("fast");if(h&&(Solo.Backup.config_angiekey=="")){a("#angie-password-warning").show()}Solo.Backup.renderBackupSteps("");Solo.Backup.startTimeoutBar(Solo.Backup.maxExecutionTime,Solo.Backup.runtimeBias);Solo.Backup.tag=Solo.Backup.srpInfo.tag;var b={ajax:"start",description:a("#backup-description").val(),comment:a("#comment").val(),jpskey:f,angiekey:h};b=array_merge(b,Solo.Backup.srpInfo);Solo.System.doAjax(b,Solo.Backup.onStep,Solo.Backup.onError,false)};Solo.Backup.onStep=function(d){try{console.log("Running backup step");console.log(d)}catch(f){}Solo.Backup.resetTimeoutBar();Solo.Backup.renderBackupSteps(d.Domain);var c=d.Progress+"%";a("#backup-percentage div.bar").css({width:d.Progress+"%"});if(d.Progress>=100){Piecon.setProgress(99)}else{Piecon.setProgress(d.Progress)}a("#backup-step").html(d.Step);a("#backup-substep").html(d.Substep);if(d.Warnings.length>0){a("#backup-percentage").addClass("progress-warning");a.each(d.Warnings,function(g,h){var e=a(document.createElement("div")).html(h).appendTo(a("#warnings-list"))});if(a("#backup-warnings-panel").is(":hidden")){a("#backup-warnings-panel").show("fast")}}var b=d.Error;if(b!=""){try{console.error("Got an error message");console.log(b)}catch(f){}Solo.Backup.onError(b);return}else{if(d.HasRun==1){try{console.log("Backup complete");console.log(b)}catch(f){}Solo.Backup.onDone()}else{if(empty(Solo.Backup.tag)){Solo.Backup.tag="backend"}Solo.Backup.startTimeoutBar(Solo.Backup.maxExecutionTime,Solo.Backup.runtimeBias);try{console.log("Starting tick timer")}catch(f){}Solo.Backup.timer()}}};Solo.Backup.onError=function(b){Solo.Backup.resetTimeoutBar();try{Piecon.reset()}catch(c){}a("#backup-progress-pane").hide("fast");a("#backup-warnings-panel").hide("fast");a("#backup-error-message").html(b);a("#error-panel").show()};Solo.Backup.onDone=function(){Solo.Backup.resetTimeoutBar();try{Piecon.reset()}catch(b){}a("#backup-progress-pane").hide("fast");a("#backup-complete").show();a("#backup-warnings-panel").width("100%");if(Solo.Backup.returnUrl!=""){if(Solo.Backup.isSTW){alert(Solo.Backup.translations["UI-STW-CONTINUE"])}window.location=Solo.Backup.returnUrl}};Solo.Backup.restoreDefaultOptions=function(){a("#backup-description").val(Solo.Backup.default_descr);if(a("#angiekey").length){a("#angiekey").val(Solo.Backup.config_angiekey)}if(a("#jpskey").length){a("#jpskey").val(Solo.Backup.jpsKey)}a("#comment").val("")}}(akeeba.jQuery));
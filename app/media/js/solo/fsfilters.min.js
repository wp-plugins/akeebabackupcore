if(typeof Solo=="undefined"){var Solo={}}if(typeof Solo.Fsfilters=="undefined"){Solo.Fsfilters={translations:{},currentRoot:null,loadingGif:""}}(function(a){Solo.Fsfilters.activeRootChanged=function(){var b={};b.root=a("#active_root").val();b.crumbs=[];b.node="";Solo.Fsfilters.load(b)};Solo.Fsfilters.load=function(d){d.verb="list";var c=JSON.stringify(d);var b={};b.akaction=c;Solo.System.doAjax(b,function(e){Solo.Fsfilters.render(e)},null,false,15000)};Solo.Fsfilters.toggle=function(g,d,h,f){if(f==null){f=true}if(d!=null){if(d.data("loading")==true){return}d.data("loading",true);if(f){var c=d.children("span:first")}else{var c=d}d.data("icon",c.attr("class"));c.removeClass(d.data("icon"));c.addClass("fa");c.addClass("ak-toggle-button");c.addClass("ak-toggle-button-spinning");c.addClass("fa-square");c.everyTime(250,"spinner",function(){if(c.hasClass("fa-square")){c.removeClass("fa-square");c.addClass("fa-square-o")}else{c.removeClass("fa-square-o");c.addClass("fa-square")}})}var e=JSON.stringify(g);var b={akaction:e};Solo.System.doAjax(b,function(i){if(d!=null){c.stopTime();c.attr("class",d.data("icon"));d.removeData("icon");d.removeData("loading")}if(i.success==true){if(d!=null){if(f){if(i.newstate==true){d.removeClass("label-default");d.addClass("label-warning")}else{d.addClass("label-default");d.removeClass("label-warning")}}}if(!(h==null)){h(i,d)}}else{if(!(h==null)){h(i,d)}var j=Solo.Fsfilters.translations["UI-ERROR-FILTER"].replace("%s",g.node);Solo.System.params.errorCallback(j)}},function(i){if(d!=null){c.stopTime();c.attr("class",d.data("icon"));d.removeData("icon");d.removeData("loading")}Solo.System.params.errorCallback(i)},false,15000)};Solo.Fsfilters.render=function(f){Solo.Fsfilters.currentRoot=f.root;var j=[];var d=[Solo.Fsfilters.translations["UI-ROOT"],f.root,[],""];j.push(d);if(f.crumbs.length>0){var h=[];a.each(f.crumbs,function(n,o){var p=[o,f.root,h.slice(0),o];j.push(p);h.push(o)})}var e=a("#ak_crumbs");e.html("");a.each(j,function(n,p){var o=a(document.createElement("li"));a(document.createElement("a")).attr("href","javascript:").html(p[0]).click(function(){a(this).append(a(document.createElement("img")).attr({src:Solo.Fsfilters.loadingGif,width:16,height:11,border:0,alt:"Loading..."}).css({marginTop:"5px",marginLeft:"5px"}));var q={root:p[1],crumbs:p[2],node:p[3]};Solo.Fsfilters.load(q)}).appendTo(o);o.appendTo(e)});var k=a("#folders");k.html("");if(f.crumbs.length>0){var m=a(document.createElement("div")).addClass("folder-container");m.append(a(document.createElement("span")).addClass("folder-padding")).append(a(document.createElement("span")).addClass("folder-name folder-up").html(" <i>"+e.find("li:last").prev().find("a").html()+"</i>").prepend(a(document.createElement("span")).addClass("fa fa-level-up")).click(function(){e.find("li:last").prev().find("a").click()})).appendTo(k)}if(Object.keys(f.folders).length>0){var c=["directories_all","skipdirs_all","skipfiles_all"];var i=a(document.createElement("div")).addClass("folder-header folder-container");a.each(c,function(n,o){var q=a(document.createElement("span")).addClass("label label-default folder-icon-container").attr("title",Solo.Fsfilters.translations["UI-FILTERTYPE-"+o.toUpperCase()]);var p="";switch(o){case"directories_all":p="fa-ban";q.append('<span class="ak-toggle-button fa fa-ban"></span>');break;case"skipdirs_all":p="fa-folder-open";q.append('<span class="ak-toggle-button fa fa-folder-open"></span>');break;case"skipfiles_all":p="fa-file";q.append('<span class="ak-toggle-button fa fa-file"></span>');break}q.click(function(){var r;if(a(this).hasClass("label-warning")){a(this).removeClass("label-warning").addClass("label-default");r=false}else{a(this).addClass("label-warning").removeClass("label-default");r=true}a.each(k.find(".folder-container").not(".folder-header").find("span."+p),function(s,u){var t=a(u).parent().hasClass("label-warning");if((!r&&!t)||(r&&t)){return}a(u).click()})});q.appendTo(i)});a(document.createElement("span")).addClass("folder-name").html('<span class="fa fa-long-arrow-left"></span>'+Solo.Fsfilters.translations["UI-FILTERTYPE-APPLYTOALLDIRS"]).appendTo(i);i.appendTo(k)}a.each(f.folders,function(o,p){var n=a(document.createElement("div")).addClass("folder-container");var q=["directories","skipdirs","skipfiles"];a.each(q,function(r,s){var t=a(document.createElement("span")).addClass("label folder-icon-container").attr("title",Solo.Fsfilters.translations["UI-FILTERTYPE-"+s.toUpperCase()]);switch(s){case"directories":t.append('<span class="ak-toggle-button fa fa-ban"></span>');break;case"skipdirs":t.append('<span class="ak-toggle-button fa fa-folder-open"></span>');break;case"skipfiles":t.append('<span class="ak-toggle-button fa fa-file"></span>');break}t.tooltip({placement:"bottom",delay:0});t.addClass("label-default");switch(p[s]){case 2:t.removeClass("label-default");t.addClass("label-danger");break;case 1:t.removeClass("label-default");t.addClass("label-warning");case 0:t.click(function(){var u={root:f.root,crumbs:h,node:o,filter:s,verb:"toggle"};Solo.Fsfilters.toggle(u,t)})}t.appendTo(n)});a(document.createElement("span")).html(o).addClass("folder-name").click(function(){a(this).append(a(document.createElement("img")).attr({src:Solo.Fsfilters.loadingGif,width:16,height:11,border:0,alt:"Loading..."}).css({marginTop:"3px",marginLeft:"5px"}));var r={root:f.root,crumbs:h,node:o};Solo.Fsfilters.load(r)}).appendTo(n);n.appendTo(k)});var g=a("#files");g.html("");if(Object.keys(f.files).length>0){var l=a(document.createElement("div")).addClass("file-header file-container");var b=a(document.createElement("span")).addClass("label label-default file-icon-container").attr("title",Solo.Fsfilters.translations["UI-FILTERTYPE-FILES_ALL"]);b.append('<span class="ak-toggle-button fa fa-file-text"></span>');b.click(function(){var n;if(a(this).hasClass("label-warning")){a(this).removeClass("label-warning").addClass("label-default");n=false}else{a(this).addClass("label-warning").removeClass("label-default");n=true}a.each(g.find(".file-container").not(".file-header").find("span.fa-file-text"),function(o,q){var p=a(q).parent().hasClass("label-warning");if((!n&&!p)||(n&&p)){return}a(q).click()})});b.appendTo(l);a(document.createElement("span")).addClass("file-name").html('<span class="fa fa-long-arrow-left"></span>'+Solo.Fsfilters.translations["UI-FILTERTYPE-APPLYTOALLFILES"]).appendTo(l);l.appendTo(g)}a.each(f.files,function(o,p){var n=a(document.createElement("div")).addClass("file-container");var q=["files"];a.each(q,function(r,s){var t=a(document.createElement("span")).addClass("file-icon-container label").attr("title",Solo.Fsfilters.translations["UI-FILTERTYPE-"+s.toUpperCase()]);switch(s){case"files":t.append('<span class="ak-toggle-button fa fa-file-text"></span>');break}t.tooltip({placement:"bottom",delay:0,title:Solo.Fsfilters.translations["UI-FILTERTYPE-"+s.toUpperCase()]});t.addClass("label-default");switch(p[s]){case 2:t.removeClass("label-default");t.addClass("label-danger");break;case 1:t.removeClass("label-default");t.addClass("label-warning");case 0:t.click(function(){var u={root:f.root,crumbs:h,node:o,filter:s,verb:"toggle"};Solo.Fsfilters.toggle(u,t)})}t.appendTo(n)});n.append(a(document.createElement("span")).addClass("file-name").html(o)).append(a(document.createElement("span")).addClass("file-size").html(size_format(p.size)));n.appendTo(g)})};Solo.Fsfilters.nuke=function(){var c={root:Solo.Fsfilters.currentRoot,verb:"reset"};var b={akaction:JSON.stringify(c)};Solo.System.doAjax(b,function(d){Solo.Fsfilters.render(d)},null,false,15000)};Solo.Fsfilters.loadTab=function(c){var d={verb:"tab",root:c};var b={akaction:JSON.stringify(d)};Solo.System.doAjax(b,function(e){Solo.Fsfilters.renderTab(e)},null,false,15000)};Solo.Fsfilters.addRow=function(d,c){var b=Solo.Fsfilters.translations["UI-FILTERTYPE-"+d.type.toUpperCase()];if(b==null){b=d.type}a(document.createElement("tr")).addClass("ak_filter_row").append(a(document.createElement("td")).addClass("ak_filter_type").append(b)).append(a(document.createElement("td")).addClass("ak_filter_item").append(a(document.createElement("span")).addClass("ak_filter_tab_icon_container label label-default").click(function(){if(d.node==""){a(this).parent().parent().remove();return}var e={root:a("#active_root").val(),crumbs:[],node:d.node,filter:d.type,verb:"toggle"};Solo.Fsfilters.toggle(e,a(this),function(f,g){if(f.success){g.parent().parent().remove()}})}).append(a(document.createElement("span")).addClass("ak-toggle-button fa fa-trash-o deletebutton"))).append(a(document.createElement("span")).addClass("ak_filter_tab_icon_container label label-default").click(function(){if(a(this).siblings("span.ak_filter_tab_icon_container:first").next().data("editing")){return}a(this).siblings("span.ak_filter_tab_icon_container:first").next().data("editing",true);a(this).next().hide();a(document.createElement("input")).attr({type:"text",size:60}).val(a(this).next().html()).appendTo(a(this).parent()).blur(function(){var f=a(this).val();if(f==""){a(this).parent().children("span.ak_filter_name").show();a(this).siblings("span.ak_filter_tab_icon_container").find("span.deletebutton").click();a(this).remove();return}var e={root:a("#active_root").val(),crumbs:[],old_node:d.node,new_node:f,filter:d.type,verb:"swap"};var g=a(this);Solo.Fsfilters.toggle(e,g.siblings("span.ak_filter_tab_icon_container:first").next(),function(h,i){g.siblings("span.ak_filter_tab_icon_container:first").next().removeData("editing");g.parent().find("span.ak_filter_name").show();g.siblings("span.ak_filter_tab_icon_container:first").next().removeClass("label-warning").addClass("label-default");g.parent().find("span.ak_filter_name").html(f);g.remove();d.node=f})}).focus()}).append(a(document.createElement("span")).addClass("ak-toggle-button fa fa-pencil-square editbutton"))).append(a(document.createElement("span")).addClass("ak_filter_name").html(d.node))).appendTo(a(c))};Solo.Fsfilters.addNew=function(c){var b={type:c,node:""};Solo.Fsfilters.addRow(b,a("#ak_list_table"));a("#ak_list_table tr:last").children("td:last").children("span.ak_filter_tab_icon_container:last").click()};Solo.Fsfilters.renderTab=function(c){var b=a("#ak_list_contents");b.html("");a.each(c,function(d,e){Solo.Fsfilters.addRow(e,b)})}}(akeeba.jQuery));
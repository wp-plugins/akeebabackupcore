if(typeof Solo=="undefined"){var Solo={}}if(typeof Solo.Fsfilters=="undefined"){Solo.Fsfilters={translations:{},currentRoot:null,loadingGif:""}}(function(a){Solo.Fsfilters.activeRootChanged=function(){var b={};b.root=a("#active_root").val();b.crumbs=[];b.node="";Solo.Fsfilters.load(b)};Solo.Fsfilters.load=function(d){d.verb="list";var c=JSON.stringify(d);var b={};b.action=c;Solo.System.doAjax(b,function(e){Solo.Fsfilters.render(e)},null,false,15000)};Solo.Fsfilters.toggle=function(g,d,h,f){if(f==null){f=true}if(d!=null){if(d.data("loading")==true){return}d.data("loading",true);if(f){var c=d.children("span:first")}else{var c=d}d.data("icon",c.attr("class"));c.removeClass(d.data("icon"));c.addClass("fa");c.addClass("ak-toggle-button");c.addClass("ak-toggle-button-spinning");c.addClass("fa-square");c.everyTime(250,"spinner",function(){if(c.hasClass("fa-square")){c.removeClass("fa-square");c.addClass("fa-square-o")}else{c.removeClass("fa-square-o");c.addClass("fa-square")}})}var e=JSON.stringify(g);var b={action:e};Solo.System.doAjax(b,function(i){if(d!=null){c.stopTime();c.attr("class",d.data("icon"));d.removeData("icon");d.removeData("loading")}if(i.success==true){if(d!=null){if(f){if(i.newstate==true){d.removeClass("label-default");d.addClass("label-warning")}else{d.addClass("label-default");d.removeClass("label-warning")}}}if(!(h==null)){h(i,d)}}else{if(!(h==null)){h(i,d)}var j=Solo.Fsfilters.translations["UI-ERROR-FILTER"].replace("%s",g.node);Solo.System.params.errorCallback(j)}},function(i){if(d!=null){c.stopTime();c.attr("class",d.data("icon"));d.removeData("icon");d.removeData("loading")}Solo.System.params.errorCallback(i)},false,15000)};Solo.Fsfilters.render=function(g){Solo.Fsfilters.currentRoot=g.root;var i=[];var d=[Solo.Fsfilters.translations["UI-ROOT"],g.root,[],""];i.push(d);if(g.crumbs.length>0){var b=[];a.each(g.crumbs,function(j,k){var l=[k,g.root,b.slice(0),k];i.push(l);b.push(k)})}var c=a("#ak_crumbs");c.html("");a.each(i,function(j,l){var k=a(document.createElement("li"));a(document.createElement("a")).attr("href","javascript:").html(l[0]).click(function(){a(this).append(a(document.createElement("img")).attr({src:Solo.Fsfilters.loadingGif,width:16,height:11,border:0,alt:"Loading..."}).css({marginTop:"5px",marginLeft:"5px"}));var m={root:l[1],crumbs:l[2],node:l[3]};Solo.Fsfilters.load(m)}).appendTo(k);k.appendTo(c)});var f=a("#folders");f.html("");if(g.crumbs.length>0){var e=a(document.createElement("div")).addClass("folder-container");e.append(a(document.createElement("span")).addClass("folder-padding")).append(a(document.createElement("span")).addClass("folder-name folder-up").html(" <i>"+c.find("li:last").prev().find("a").html()+"</i>").prepend(a(document.createElement("span")).addClass("fa fa-level-up")).click(function(){c.find("li:last").prev().find("a").click()})).appendTo(f)}a.each(g.folders,function(k,l){var j=a(document.createElement("div")).addClass("folder-container");var m=["directories","skipdirs","skipfiles"];a.each(m,function(n,o){var p=a(document.createElement("span")).addClass("label folder-icon-container").attr("title",Solo.Fsfilters.translations["UI-FILTERTYPE-"+o.toUpperCase()]);switch(o){case"directories":p.append('<span class="ak-toggle-button fa fa-ban"></span>');break;case"skipdirs":p.append('<span class="ak-toggle-button fa fa-folder-open"></span>');break;case"skipfiles":p.append('<span class="ak-toggle-button fa fa-file"></span>');break}p.tooltip({placement:"bottom",delay:0});p.addClass("label-default");switch(l[o]){case 2:p.removeClass("label-default");p.addClass("label-danger");break;case 1:p.removeClass("label-default");p.addClass("label-warning");case 0:p.click(function(){var q={root:g.root,crumbs:b,node:k,filter:o,verb:"toggle"};Solo.Fsfilters.toggle(q,p)})}p.appendTo(j)});a(document.createElement("span")).html(k).addClass("folder-name").click(function(){a(this).append(a(document.createElement("img")).attr({src:Solo.Fsfilters.loadingGif,width:16,height:11,border:0,alt:"Loading..."}).css({marginTop:"3px",marginLeft:"5px"}));var n={root:g.root,crumbs:b,node:k};Solo.Fsfilters.load(n)}).appendTo(j);j.appendTo(f)});var h=a("#files");h.html("");a.each(g.files,function(k,l){var j=a(document.createElement("div")).addClass("file-container");var m=["files"];a.each(m,function(n,o){var p=a(document.createElement("span")).addClass("file-icon-container label").attr("title",Solo.Fsfilters.translations["UI-FILTERTYPE-"+o.toUpperCase()]);switch(o){case"files":p.append('<span class="ak-toggle-button fa fa-file-text"></span>');break}p.tooltip({placement:"bottom",delay:0,title:Solo.Fsfilters.translations["UI-FILTERTYPE-"+o.toUpperCase()]});p.addClass("label-default");switch(l[o]){case 2:p.removeClass("label-default");p.addClass("label-danger");break;case 1:p.removeClass("label-default");p.addClass("label-warning");case 0:p.click(function(){var q={root:g.root,crumbs:b,node:k,filter:o,verb:"toggle"};Solo.Fsfilters.toggle(q,p)})}p.appendTo(j)});j.append(a(document.createElement("span")).addClass("file-name").html(k)).append(a(document.createElement("span")).addClass("file-size").html(size_format(l.size)));j.appendTo(h)})};Solo.Fsfilters.nuke=function(){var c={root:Solo.Fsfilters.currentRoot,verb:"reset"};var b={action:JSON.stringify(c)};Solo.System.doAjax(b,function(d){Solo.Fsfilters.render(d)},null,false,15000)};Solo.Fsfilters.loadTab=function(c){var d={verb:"tab",root:c};var b={action:JSON.stringify(d)};Solo.System.doAjax(b,function(e){Solo.Fsfilters.renderTab(e)},null,false,15000)};Solo.Fsfilters.addRow=function(d,c){var b=Solo.Fsfilters.translations["UI-FILTERTYPE-"+d.type.toUpperCase()];if(b==null){b=d.type}a(document.createElement("tr")).addClass("ak_filter_row").append(a(document.createElement("td")).addClass("ak_filter_type").append(b)).append(a(document.createElement("td")).addClass("ak_filter_item").append(a(document.createElement("span")).addClass("ak_filter_tab_icon_container label label-default").click(function(){if(d.node==""){a(this).parent().parent().remove();return}var e={root:a("#active_root").val(),crumbs:[],node:d.node,filter:d.type,verb:"toggle"};Solo.Fsfilters.toggle(e,a(this),function(f,g){if(f.success){g.parent().parent().remove()}})}).append(a(document.createElement("span")).addClass("ak-toggle-button fa fa-trash-o deletebutton"))).append(a(document.createElement("span")).addClass("ak_filter_tab_icon_container label label-default").click(function(){if(a(this).siblings("span.ak_filter_tab_icon_container:first").next().data("editing")){return}a(this).siblings("span.ak_filter_tab_icon_container:first").next().data("editing",true);a(this).next().hide();a(document.createElement("input")).attr({type:"text",size:60}).val(a(this).next().html()).appendTo(a(this).parent()).blur(function(){var f=a(this).val();if(f==""){a(this).parent().children("span.ak_filter_name").show();a(this).siblings("span.ak_filter_tab_icon_container").find("span.deletebutton").click();a(this).remove();return}var e={root:a("#active_root").val(),crumbs:[],old_node:d.node,new_node:f,filter:d.type,verb:"swap"};var g=a(this);Solo.Fsfilters.toggle(e,g.siblings("span.ak_filter_tab_icon_container:first").next(),function(h,i){g.siblings("span.ak_filter_tab_icon_container:first").next().removeData("editing");g.parent().find("span.ak_filter_name").show();g.siblings("span.ak_filter_tab_icon_container:first").next().removeClass("label-warning").addClass("label-default");g.parent().find("span.ak_filter_name").html(f);g.remove();d.node=f})}).focus()}).append(a(document.createElement("span")).addClass("ak-toggle-button fa fa-pencil-square editbutton"))).append(a(document.createElement("span")).addClass("ak_filter_name").html(d.node))).appendTo(a(c))};Solo.Fsfilters.addNew=function(c){var b={type:c,node:""};Solo.Fsfilters.addRow(b,a("#ak_list_table"));a("#ak_list_table tr:last").children("td:last").children("span.ak_filter_tab_icon_container:last").click()};Solo.Fsfilters.renderTab=function(c){var b=a("#ak_list_contents");b.html("");a.each(c,function(d,e){Solo.Fsfilters.addRow(e,b)})}}(akeeba.jQuery));
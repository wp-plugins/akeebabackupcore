if(typeof Solo=="undefined"){var Solo={}}if(typeof Solo.Dbfilters=="undefined"){Solo.Dbfilters={translations:{},currentRoot:null,loadingGif:""}}(function(a){Solo.Dbfilters.activeRootChanged=function(){var b={root:a("#active_root").val()};Solo.Dbfilters.load(b)};Solo.Dbfilters.load=function(c){c.verb="list";var b={akaction:JSON.stringify(c)};Solo.System.doAjax(b,function(d){Solo.Dbfilters.render(d)},null,false,15000)};Solo.Dbfilters.toggle=function(c,b,d){Solo.Fsfilters.toggle(c,b,d)};Solo.Dbfilters.render=function(c){Solo.Dbfilters.currentRoot=c.root;var b=a("#tables");b.html("");a.each(c.tables,function(h,d){var f=a(document.createElement("div")).addClass("table-container");var i=["tables","tabledata"];a.each(i,function(j,k){var l=a(document.createElement("span")).addClass("table-icon-container label label-default").attr("title",Solo.Dbfilters.translations["UI-FILTERTYPE-"+k.toUpperCase()]);switch(k){case"tables":l.append('<span class="ak-toggle-button fa fa-ban"></span>');break;case"tabledata":l.append('<span class="ak-toggle-button fa fa-bars"></span>');break}l.tooltip({placement:"bottom",delay:0});switch(d[k]){case 2:l.addClass("label-danger").removeClass("label-default");break;case 1:l.addClass("label-warning").removeClass("label-default");case 0:l.click(function(){var m={root:c.root,node:h,filter:k,verb:"toggle"};Solo.Dbfilters.toggle(m,l)})}l.appendTo(f)});var g="fa-square-o";var e="UI-TABLETYPE-MISC";switch(d.type){case"table":g="fa-table";e="UI-TABLETYPE-TABLE";break;case"view":g="fa-list-alt";e="UI-TABLETYPE-VIEW";break;case"procedure":g="fa-terminal";e="UI-TABLETYPE-PROCEDURE";break;case"function":g="fa-bolt";e="UI-TABLETYPE-FUNCTION";break;case"trigger":g="fa-code-fork";e="UI-TABLETYPE-TRIGGER";break}a(document.createElement("span")).addClass("table-name").html(h).prepend(a(document.createElement("span")).addClass("table-icon-container table-icon-noclick table-icon-small").attr("title",Solo.Dbfilters.translations[e]).append(a(document.createElement("span")).addClass("fa").addClass(g)).tooltip({placement:"bottom",delay:0})).prepend(a(document.createElement("span")).addClass("table-icon-container table-icon-noclick table-icon-small").append(a(document.createElement("span")).addClass("fa fa-ellipsis-v"))).appendTo(f);f.appendTo(b)})};Solo.Dbfilters.loadTab=function(c){var d={verb:"tab",root:c};var b={akaction:JSON.stringify(d)};Solo.System.doAjax(b,function(e){Solo.Dbfilters.renderTab(e)},null,false,15000)};Solo.Dbfilters.addRow=function(d,c){var b=Solo.Dbfilters.translations["UI-FILTERTYPE-"+d.type.toUpperCase()];if(b==null){b=d.type}a(document.createElement("tr")).addClass("ak_filter_row").append(a(document.createElement("td")).addClass("ak_filter_type").append(b)).append(a(document.createElement("td")).addClass("ak_filter_item").append(a(document.createElement("span")).addClass("ak_filter_tab_icon_container label label-default").click(function(){if(d.node==""){a(this).parent().parent().remove();return}var e={root:a("#active_root").val(),node:d.node,filter:d.type,verb:"remove"};Solo.Dbfilters.toggle(e,a(this),function(f,g){if(f.success){g.parent().parent().remove()}})}).append(a(document.createElement("span")).addClass("ak-toggle-button fa fa-trash-o deletebutton"))).append(a(document.createElement("span")).addClass("ak_filter_tab_icon_container label label-default").click(function(){if(a(this).siblings("span.ak_filter_tab_icon_container:first").next().data("editing")){return}a(this).siblings("span.ak_filter_tab_icon_container:first").next().data("editing",true);a(this).next().hide();a(document.createElement("input")).attr({type:"text",size:60}).val(a(this).next().html()).appendTo(a(this).parent()).blur(function(){var f=a(this).val();if(f==""){a(this).parent().children("span.ak_filter_name").show();a(this).siblings("span.ak_filter_tab_icon_container").find("span.deletebutton").click();a(this).remove();return}var e={root:a("#active_root").val(),old_node:d.node,new_node:f,filter:d.type,verb:"swap"};var g=a(this);Solo.Dbfilters.toggle(e,g.siblings("span.ak_filter_tab_icon_container:first").next(),function(h,i){g.siblings("span.ak_filter_tab_icon_container:first").next().removeData("editing");g.parent().find("span.ak_filter_name").show();g.siblings("span.ak_filter_tab_icon_container:first").next().removeClass("label-warning").addClass("label-default");g.parent().find("span.ak_filter_name").html(f);g.remove();d.node=f})}).focus()}).append(a(document.createElement("span")).addClass("ak-toggle-button fa fa-pencil-square editbutton"))).append(a(document.createElement("span")).addClass("ak_filter_name").html(d.node))).appendTo(a(c))};Solo.Dbfilters.addNew=function(c){var b={type:c,node:""};Solo.Dbfilters.addRow(b,a("#ak_list_table"));a("#ak_list_table tr:last").children("td:last").children("span.ak_filter_tab_icon_container:last").click()};Solo.Dbfilters.renderTab=function(c){var b=a("#ak_list_contents");b.html("");a.each(c,function(d,e){Solo.Dbfilters.addRow(e,b)})};Solo.Dbfilters.excludeNonCMS=function(){a("#tables div").each(function(c,b){var e=a(b).find("span.table-name:first").text();var f=e.substr(0,3);if(f!="#__"){var d=a(b).find("span.table-icon-container span:first");if(!(a(d).parent().hasClass("label-warning"))){a(d).click()}}})};Solo.Dbfilters.nuke=function(){var c={root:Solo.Dbfilters.currentRoot,verb:"reset"};var b={akaction:JSON.stringify(c)};Solo.System.doAjax(b,function(d){Solo.Dbfilters.render(d)},null,false,15000)}}(akeeba.jQuery));
if(typeof Solo=="undefined"){var Solo={}}if(typeof Solo.Setup=="undefined"){Solo.Setup={};Solo.Setup.translations={};Solo.Setup.URLs={};Solo.Setup.FtpBrowser={params:{}};Solo.Setup.SftpBrowser={params:{}};Solo.Setup.FtpTest={};Solo.Setup.SftpTest={}}(function(a){Solo.Setup.onFsDriverClick=function(c){var b=a("#fs_driver").val();if((b=="ftp")||(b=="sftp")){a("#ftp_options").css("display","block")}else{a("#ftp_options").css("display","none")}};Solo.Setup.init=function(){a("#fs_driver").on("change",Solo.Setup.onFsDriverClick);this.onFsDriverClick()};Solo.Setup.FtpBrowser.callback=function(d){var c=("/").replace(/([\[\]\(\)\.\?\/\*\{\}\+\$\^\:])/g,"$1");var b=new RegExp("^["+c+"]+","g");d="/"+(d+"").replace(b,"");a(document.getElementById(Solo.Setup.FtpBrowser.params.key)).val(d)};Solo.Setup.FtpBrowser.initialise=function(c,b){Solo.Setup.FtpBrowser.params.host=a(document.getElementById(b+"_host")).val();Solo.Setup.FtpBrowser.params.port=a(document.getElementById(b+"_port")).val();Solo.Setup.FtpBrowser.params.username=a(document.getElementById(b+"_username")).val();Solo.Setup.FtpBrowser.params.password=a(document.getElementById(b+"_password")).val();Solo.Setup.FtpBrowser.params.passive=true;Solo.Setup.FtpBrowser.params.ssl=false;Solo.Setup.FtpBrowser.params.directory=a(document.getElementById(b+"_directory")).val();Solo.Setup.FtpBrowser.params.key=c;Solo.Setup.FtpBrowser.open()};Solo.Setup.FtpBrowser.open=function(){var b=a("#ftpdialog");b.css("display","block");b.removeClass("ui-state-error");a("#ftpdialogOkButton").click(function(d){Solo.Setup.FtpBrowser.callback(Solo.Setup.FtpBrowser.params.directory);a("#ftpdialog").modal("hide")});a("#ftpdialog").modal("show");a("#ftpBrowserErrorContainer").css("display","none");a("#ftpBrowserFolderList").html("");a("#ftpBrowserCrumbs").html("");Solo.System.params.AjaxURL=Solo.Setup.URLs.ftpBrowser;if(empty(Solo.Setup.FtpBrowser.params.directory)){Solo.Setup.FtpBrowser.params.directory=""}var c={host:Solo.Setup.FtpBrowser.params.host,port:Solo.Setup.FtpBrowser.params.port,username:Solo.Setup.FtpBrowser.params.username,password:Solo.Setup.FtpBrowser.params.password,passive:(Solo.Setup.FtpBrowser.params.passive?1:0),ssl:(Solo.Setup.FtpBrowser.params.ssl?1:0),directory:Solo.Setup.FtpBrowser.params.directory};Solo.System.doAjax(c,function(e){if(e.error!=false){a("#ftpBrowserError").html(e.error);a("#ftpBrowserErrorContainer").css("display","block");a("#ftpBrowserFolderList").css("display","none");a("#ak_crumbs").css("display","none")}else{a("#ftpBrowserErrorContainer").css("display","none");if(!empty(e.breadcrumbs)){a("#ak_crumbs").css("display","block");a("#ak_crumbs").html("");var d="/";Solo.Setup.FtpBrowser.addCrumb(Solo.Setup.translations["UI-ROOT"],"/",a("#ak_crumbs"));a.each(e.breadcrumbs,function(g,f){d+="/"+f;Solo.Setup.FtpBrowser.addCrumb(f,d,a("#ak_crumbs"))})}else{a("#ftpBrowserCrumbs").css("display","none")}if(!empty(e.list)){a("#ftpBrowserFolderList").css("display","block");a.each(e.list,function(f,g){Solo.Setup.FtpBrowser.createLink(Solo.Setup.FtpBrowser.params.directory+"/"+g,g,a("#ftpBrowserFolderList"))})}else{a("#ftpBrowserFolderList").css("display","none")}}},function(d){a("#ftpBrowserError").html(d);a("#ftpBrowserErrorContainer").css("display","block");a("#ftpBrowserFolderList").css("display","none");a("#ftpBrowserCrumbs").css("display","none")},false)};Solo.Setup.FtpBrowser.createLink=function(g,e,c,f){if(typeof f=="undefined"){f=Solo.Setup.FtpBrowser}var h=a(document.createElement("tr"));var b=a(document.createElement("td")).appendTo(h);var d=a(document.createElement("a")).text(e).click(function(){f.params.directory=g;f.open()}).appendTo(b);h.appendTo(a(c))};Solo.Setup.FtpBrowser.addCrumb=function(e,d,c,f){if(typeof f=="undefined"){f=Solo.Setup.FtpBrowser}var b=a(document.createElement("li"));a(document.createElement("a")).html(e).click(function(g){f.params.directory=d;f.open();g.preventDefault()}).appendTo(b);b.appendTo(c)};Solo.Setup.SftpBrowser.initialise=function(c,b){Solo.Setup.SftpBrowser.params.host=a(document.getElementById(b+"_host")).val();Solo.Setup.SftpBrowser.params.port=a(document.getElementById(b+"_port")).val();Solo.Setup.SftpBrowser.params.username=a(document.getElementById(b+"_username")).val();Solo.Setup.SftpBrowser.params.password=a(document.getElementById(b+"_password")).val();Solo.Setup.SftpBrowser.params.directory=a(document.getElementById(b+"_directory")).val();Solo.Setup.SftpBrowser.params.privKey="";Solo.Setup.SftpBrowser.params.pubKey="";Solo.Setup.FtpBrowser.params.key=c;Solo.Setup.SftpBrowser.open()};Solo.Setup.SftpBrowser.open=function(){var b=a("#sftpdialog");b.css("display","block");b.removeClass("ui-state-error");a("#sftpdialogOkButton").click(function(d){Solo.Setup.FtpBrowser.callback(Solo.Setup.SftpBrowser.params.directory);a("#sftpdialog").modal("hide")});a("#sftpdialog").modal("show");a("#sftpBrowserErrorContainer").css("display","none");a("#sftpBrowserFolderList").html("");a("#sftpBrowserCrumbs").html("");Solo.System.params.AjaxURL=Solo.Setup.URLs.sftpBrowser;if(empty(Solo.Setup.SftpBrowser.params.directory)){Solo.Setup.SftpBrowser.params.directory=""}var c={host:Solo.Setup.SftpBrowser.params.host,port:Solo.Setup.SftpBrowser.params.port,username:Solo.Setup.SftpBrowser.params.username,password:Solo.Setup.SftpBrowser.params.password,directory:Solo.Setup.SftpBrowser.params.directory,privkey:Solo.Setup.SftpBrowser.params.privKey,pubkey:Solo.Setup.SftpBrowser.params.pubKey};Solo.System.doAjax(c,function(e){if(e.error!=false){a("#sftpBrowserError").html(e.error);a("#sftpBrowserErrorContainer").css("display","block");a("#sftpBrowserFolderList").css("display","none");a("#ak_scrumbs").css("display","none")}else{a("#ftpBrowserErrorContainer").css("display","none");if(!empty(e.breadcrumbs)){a("#ak_scrumbs").css("display","block");a("#ak_scrumbs").html("");var d="/";Solo.Setup.FtpBrowser.addCrumb(Solo.Setup.translations["UI-ROOT"],"/",a("#ak_scrumbs"),Solo.Setup.SftpBrowser);a.each(e.breadcrumbs,function(g,f){d+="/"+f;Solo.Setup.FtpBrowser.addCrumb(f,d,a("#ak_scrumbs"),Solo.Setup.SftpBrowser)})}else{a("#sftpBrowserCrumbs").css("display","none")}if(!empty(e.list)){a("#sftpBrowserFolderList").css("display","block");a.each(e.list,function(f,g){Solo.Setup.FtpBrowser.createLink(Solo.Setup.SftpBrowser.params.directory+"/"+g,g,a("#sftpBrowserFolderList"),Solo.Setup.SftpBrowser)})}else{a("#sftpBrowserFolderList").css("display","none")}}},function(d){a("#sftpBrowserError").html(d);a("#sftpBrowserErrorContainer").css("display","block");a("#sftpBrowserFolderList").css("display","none");a("#sftpBrowserCrumbs").css("display","none")},false)};Solo.Setup.FtpTest.testConnection=function(b,d){var c=a(document.getElementById(b));Solo.Setup.FtpTest.buttonKey=b;c.attr("disabled","disabled");var e={host:a(document.getElementById(d+"_host")).val(),port:a(document.getElementById(d+"_port")).val(),user:a(document.getElementById(d+"_username")).val(),pass:a(document.getElementById(d+"_password")).val(),initdir:a(document.getElementById(d+"_directory")).val(),usessl:false,passive:true};Solo.System.params.AjaxURL=Solo.Setup.URLs.testFtp;Solo.System.doAjax(e,function(g){var f=a(document.getElementById(Solo.Setup.FtpTest.buttonKey));f.removeAttr("disabled");a("#testFtpDialogBodyOk").css("display","none");a("#testFtpDialogBodyFail").css("display","none");if(g===true){a("#testFtpDialogLabel").html(Solo.Setup.translations["UI-TESTFTP-OK"]);a("#testFtpDialogBodyOk").html(Solo.Setup.translations["UI-TESTFTP-OK"]);a("#testFtpDialogBodyOk").css("display","block");a("#testFtpDialogBodyFail").css("display","none")}else{a("#testFtpDialogLabel").html(Solo.Setup.translations["UI-TESTFTP-FAIL"]);a("#testFtpDialogBodyFail").html(g);a("#testFtpDialogBodyOk").css("display","none");a("#testFtpDialogBodyFail").css("display","block")}a("#testFtpDialog").modal("show")},null,false,15000)};Solo.Setup.SftpTest.testConnection=function(b,d){var c=a(document.getElementById(b));Solo.Setup.SftpTest.buttonKey=b;c.attr("disabled","disabled");var e={host:a(document.getElementById(d+"_host")).val(),port:a(document.getElementById(d+"_port")).val(),user:a(document.getElementById(d+"_username")).val(),pass:a(document.getElementById(d+"_password")).val(),initdir:a(document.getElementById(d+"_directory")).val(),privkey:"",pubkey:""};Solo.System.params.AjaxURL=Solo.Setup.URLs.testSftp;Solo.System.doAjax(e,function(g){var f=a(document.getElementById(Solo.Setup.SftpTest.buttonKey));f.removeAttr("disabled");a("#testFtpDialogBodyOk").css("display","none");a("#testFtpDialogBodyFail").css("display","none");if(g===true){a("#testFtpDialogLabel").html(Solo.Setup.translations["UI-TESTSFTP-OK"]);a("#testFtpDialogBodyOk").html(Solo.Setup.translations["UI-TESTSFTP-OK"]);a("#testFtpDialogBodyOk").css("display","block");a("#testFtpDialogBodyFail").css("display","none")}else{a("#testFtpDialogLabel").html(Solo.Setup.translations["UI-TESTSFTP-FAIL"]);a("#testFtpDialogBodyFail").html(g);a("#testFtpDialogBodyOk").css("display","none");a("#testFtpDialogBodyFail").css("display","block")}a("#testFtpDialog").modal("show")},null,false,15000)};Solo.Setup.initFtpSftpBrowser=function(){var b=a(document.getElementById("fs_driver")).val();if(b=="ftp"){Solo.Setup.FtpBrowser.initialise("fs_directory","fs")}else{if(b=="sftp"){Solo.Setup.SftpBrowser.initialise("fs_directory","fs")}}return false};Solo.Setup.testFtpSftpConnection=function(){var b=a(document.getElementById("fs_driver")).val();if(b=="ftp"){Solo.Setup.FtpTest.testConnection("btnFtpTest","fs")}else{if(b=="sftp"){Solo.Setup.SftpTest.testConnection("btnFtpTest","fs")}}return false}}(akeeba.jQuery));